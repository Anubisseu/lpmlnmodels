has_key(1) :- box(1),  apply(rb(0, 1, 1)).
:- sat(rb(0, 1, 1)), -apply(rb(0, 1, 1)).
sat(rb(0, 1, 1)) :- h(rb(0, 1, 1)), b(rb(0, 1, 1)).
sat(rb(0, 1, 1)) :- not b(rb(0, 1, 1)).
b(rb(0, 1, 1)) :- box(1).
h(rb(0, 1, 1)) :- has_key(1).

has_key(2) :- box(2),  apply(rb(1, 1, 1)).
:- sat(rb(1, 1, 1)), -apply(rb(1, 1, 1)).
sat(rb(1, 1, 1)) :- h(rb(1, 1, 1)), b(rb(1, 1, 1)).
sat(rb(1, 1, 1)) :- not b(rb(1, 1, 1)).
b(rb(1, 1, 1)) :- box(2).
h(rb(1, 1, 1)) :- has_key(2).

has_key(3) :- box(3),  apply(rb(2, 1, 1)).
:- sat(rb(2, 1, 1)), -apply(rb(2, 1, 1)).
sat(rb(2, 1, 1)) :- h(rb(2, 1, 1)), b(rb(2, 1, 1)).
sat(rb(2, 1, 1)) :- not b(rb(2, 1, 1)).
b(rb(2, 1, 1)) :- box(3).
h(rb(2, 1, 1)) :- has_key(3).

select(1) :- box(1),  apply(rb(3, 1, 1)).
:- sat(rb(3, 1, 1)), -apply(rb(3, 1, 1)).
sat(rb(3, 1, 1)) :- h(rb(3, 1, 1)), b(rb(3, 1, 1)).
sat(rb(3, 1, 1)) :- not b(rb(3, 1, 1)).
b(rb(3, 1, 1)) :- box(1).
h(rb(3, 1, 1)) :- select(1).

select(2) :- box(2),  apply(rb(4, 1, 1)).
:- sat(rb(4, 1, 1)), -apply(rb(4, 1, 1)).
sat(rb(4, 1, 1)) :- h(rb(4, 1, 1)), b(rb(4, 1, 1)).
sat(rb(4, 1, 1)) :- not b(rb(4, 1, 1)).
b(rb(4, 1, 1)) :- box(2).
h(rb(4, 1, 1)) :- select(2).

select(3) :- box(3),  apply(rb(5, 1, 1)).
:- sat(rb(5, 1, 1)), -apply(rb(5, 1, 1)).
sat(rb(5, 1, 1)) :- h(rb(5, 1, 1)), b(rb(5, 1, 1)).
sat(rb(5, 1, 1)) :- not b(rb(5, 1, 1)).
b(rb(5, 1, 1)) :- box(3).
h(rb(5, 1, 1)) :- select(3).

cannot_open(1):-select(1).
cannot_open(2):-select(2).
cannot_open(3):-select(3).
cannot_open(1):-has_key(1).
cannot_open(2):-has_key(2).
cannot_open(3):-has_key(3).
open(1) :- box(1),not cannot_open(1),  apply(rb(12, 1, 1)).
:- sat(rb(12, 1, 1)), -apply(rb(12, 1, 1)).
sat(rb(12, 1, 1)) :- h(rb(12, 1, 1)), b(rb(12, 1, 1)).
sat(rb(12, 1, 1)) :- not b(rb(12, 1, 1)).
b(rb(12, 1, 1)) :- box(1),not cannot_open(1).
h(rb(12, 1, 1)) :- open(1).

open(2) :- box(2),not cannot_open(2),  apply(rb(13, 1, 1)).
:- sat(rb(13, 1, 1)), -apply(rb(13, 1, 1)).
sat(rb(13, 1, 1)) :- h(rb(13, 1, 1)), b(rb(13, 1, 1)).
sat(rb(13, 1, 1)) :- not b(rb(13, 1, 1)).
b(rb(13, 1, 1)) :- box(2),not cannot_open(2).
h(rb(13, 1, 1)) :- open(2).

open(3) :- box(3),not cannot_open(3),  apply(rb(14, 1, 1)).
:- sat(rb(14, 1, 1)), -apply(rb(14, 1, 1)).
sat(rb(14, 1, 1)) :- h(rb(14, 1, 1)), b(rb(14, 1, 1)).
sat(rb(14, 1, 1)) :- not b(rb(14, 1, 1)).
b(rb(14, 1, 1)) :- box(3),not cannot_open(3).
h(rb(14, 1, 1)) :- open(3).

can_switch(1):-box(1),not select(1),not open(1).
can_switch(2):-box(2),not select(2),not open(2).
can_switch(3):-box(3),not select(3),not open(3).
switch(1) :- can_switch(1),  apply(rb(18, 1, 1)).
:- sat(rb(18, 1, 1)), -apply(rb(18, 1, 1)).
sat(rb(18, 1, 1)) :- h(rb(18, 1, 1)), b(rb(18, 1, 1)).
sat(rb(18, 1, 1)) :- not b(rb(18, 1, 1)).
b(rb(18, 1, 1)) :- can_switch(1).
h(rb(18, 1, 1)) :- switch(1).

switch(2) :- can_switch(2),  apply(rb(19, 1, 1)).
:- sat(rb(19, 1, 1)), -apply(rb(19, 1, 1)).
sat(rb(19, 1, 1)) :- h(rb(19, 1, 1)), b(rb(19, 1, 1)).
sat(rb(19, 1, 1)) :- not b(rb(19, 1, 1)).
b(rb(19, 1, 1)) :- can_switch(2).
h(rb(19, 1, 1)) :- switch(2).

switch(3) :- can_switch(3),  apply(rb(20, 1, 1)).
:- sat(rb(20, 1, 1)), -apply(rb(20, 1, 1)).
sat(rb(20, 1, 1)) :- h(rb(20, 1, 1)), b(rb(20, 1, 1)).
sat(rb(20, 1, 1)) :- not b(rb(20, 1, 1)).
b(rb(20, 1, 1)) :- can_switch(3).
h(rb(20, 1, 1)) :- switch(3).

win_stay:-select(1),has_key(1).
win_stay:-select(2),has_key(2).
win_stay:-select(3),has_key(3).
win_switch:-switch(1),has_key(1).
win_switch:-switch(2),has_key(2).
win_switch:-switch(3),has_key(3).
-switch(1):-switch(1),can_switch(1),1!=1.
-switch(2):-switch(1),can_switch(2),2!=1.
-switch(3):-switch(1),can_switch(3),3!=1.
-switch(1):-switch(2),can_switch(1),1!=2.
-switch(2):-switch(2),can_switch(2),2!=2.
-switch(3):-switch(2),can_switch(3),3!=2.
-switch(1):-switch(3),can_switch(1),1!=3.
-switch(2):-switch(3),can_switch(2),2!=3.
-switch(3):-switch(3),can_switch(3),3!=3.
:-can_switch(1),not switch(1),not -switch(1).
:-can_switch(2),not switch(2),not -switch(2).
:-can_switch(3),not switch(3),not -switch(3).
-select(1):-select(1),box(1),1!=1.
-select(2):-select(1),box(2),2!=1.
-select(3):-select(1),box(3),3!=1.
-select(1):-select(2),box(1),1!=2.
-select(2):-select(2),box(2),2!=2.
-select(3):-select(2),box(3),3!=2.
-select(1):-select(3),box(1),1!=3.
-select(2):-select(3),box(2),2!=3.
-select(3):-select(3),box(3),3!=3.
:-box(1),not select(1),not -select(1).
:-box(2),not select(2),not -select(2).
:-box(3),not select(3),not -select(3).
-open(1):-open(1),box(1),1!=1.
-open(2):-open(1),box(2),2!=1.
-open(3):-open(1),box(3),3!=1.
-open(1):-open(2),box(1),1!=2.
-open(2):-open(2),box(2),2!=2.
-open(3):-open(2),box(3),3!=2.
-open(1):-open(3),box(1),1!=3.
-open(2):-open(3),box(2),2!=3.
-open(3):-open(3),box(3),3!=3.
:-box(1),not open(1),not -open(1).
:-box(2),not open(2),not -open(2).
:-box(3),not open(3),not -open(3).
-has_key(1):-has_key(1),box(1),1!=1.
-has_key(2):-has_key(1),box(2),2!=1.
-has_key(3):-has_key(1),box(3),3!=1.
-has_key(1):-has_key(2),box(1),1!=2.
-has_key(2):-has_key(2),box(2),2!=2.
-has_key(3):-has_key(2),box(3),3!=2.
-has_key(1):-has_key(3),box(1),1!=3.
-has_key(2):-has_key(3),box(2),2!=3.
-has_key(3):-has_key(3),box(3),3!=3.
:-box(1),not has_key(1),not -has_key(1).
:-box(2),not has_key(2),not -has_key(2).
:-box(3),not has_key(3),not -has_key(3).
box(1).
box(2).
box(3).
:~ sat(rb(0, 1, 1)). [1@1, 0]
:~ sat(rb(1, 1, 1)). [1@1, 1]
:~ sat(rb(2, 1, 1)). [1@1, 2]
:~ sat(rb(3, 1, 1)). [1@1, 3]
:~ sat(rb(4, 1, 1)). [1@1, 4]
:~ sat(rb(5, 1, 1)). [1@1, 5]
:~ sat(rb(12, 1, 1)). [1@1, 12]
:~ sat(rb(13, 1, 1)). [1@1, 13]
:~ sat(rb(14, 1, 1)). [1@1, 14]
:~ sat(rb(18, 1, 1)). [1@1, 18]
:~ sat(rb(19, 1, 1)). [1@1, 19]
:~ sat(rb(20, 1, 1)). [1@1, 20]
kse_solve_trick.  
:~ kse_solve_trick. [1@1]
:~ kse_solve_trick. [1@2]

#showselect/1.
#showhas_key/1.
#showopen/1.
#showwin_stay/0.
#showswitch/1.
#showwin_switch/0.
